import streamlit as st
import pandas as pd
import plotly.express as px

# 정확한 파일명으로 수정
df = pd.read_csv("인천광역시_부동산 거래 현황_20231231.csv", encoding="cp949")

# 필요한 컬럼명 정리 (예시로 작성 — 실제 데이터에 따라 조정 필요)
df = df.rename(columns={
    '행정구역': '지역',
    '거래건수': '거래건수',
    '토지면적': '토지면적_㎡',
    '건축물면적': '건축물면적_㎡',
    '거래금액': '거래금액_백만원'
})

# Streamlit 대시보드
st.set_page_config(page_title="인천 부동산 거래 현황", layout="wide")
st.title("🏙️ 인천 부동산 거래 분석")

지역_선택 = st.sidebar.selectbox("지역 선택", df['지역'].unique())
filtered = df[df['지역'] == 지역_선택]

st.subheader(f"📌 {지역_선택} 거래 요약")
st.write(filtered)

col1, col2, col3 = st.columns(3)
col1.metric("거래 건수", int(filtered['거래건수'].values[0]))
col2.metric("토지 면적 (㎡)", f"{filtered['토지면적_㎡'].values[0]:,.2f}")
col3.metric("건축물 면적 (㎡)", f"{filtered['건축물면적_㎡'].values[0]:,.2f}")

# 시각화
st.subheader("📊 지역별 거래 금액 비교")
fig = px.bar(df.sort_values('거래금액_백만원', ascending=False), x='지역', y='거래금액_백만원',
             labels={'거래금액_백만원': '거래 금액 (백만원)'}, color='거래금액_백만원')
st.plotly_chart(fig, use_container_width=True)

st.subheader("💡 면적 대비 거래 금액")
fig2 = px.scatter(df, x='토지면적_㎡', y='거래금액_백만원', size='건축물면적_㎡',
                  hover_name='지역', trendline='ols',
                  labels={'토지면적_㎡': '토지 면적 (㎡)', '거래금액_백만원': '거래 금액 (백만원)'})
st.plotly_chart(fig2, use_container_width=True)

st.caption("📌 데이터 출처: 인천시 부동산 거래 통계")
