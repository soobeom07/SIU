import streamlit as st
import pandas as pd
import plotly.express as px

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ì§€ì—­ë³„ ë¶€ë™ì‚° ê°€ê²© ë³€ë™", layout="wide")
st.title("ğŸ“Š ì§€ì—­ë³„ ë¶€ë™ì‚° ê°€ê²© ë³€ë™ ë¶„ì„")

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv("66083188-77a1-44b2-8105-b7f3f25d937c.csv", encoding="cp949")

# ì»¬ëŸ¼ëª… í™•ì¸ ë° ì •ë¦¬
st.write("âœ… í˜„ì¬ ë°ì´í„°í”„ë ˆì„ ì»¬ëŸ¼ ëª©ë¡:", df.columns.tolist())

# ë‚ ì§œ ì»¬ëŸ¼ì´ 'ê³„ì•½ì¼'ë¡œ ê°€ì •
df = df.rename(columns={
    'ê³„ì•½ì¼': 'ë‚ ì§œ',
    'ì§€ì—­ëª…': 'ì§€ì—­',
    'ê±°ë˜ê¸ˆì•¡(ë§Œì›)': 'ê±°ë˜ê¸ˆì•¡_ë§Œì›'
})

# ë‚ ì§œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜
df['ë‚ ì§œ'] = pd.to_datetime(df['ë‚ ì§œ'], errors='coerce')
df = df.dropna(subset=['ë‚ ì§œ'])  # ë‚ ì§œ ì—†ëŠ” í–‰ ì œê±°
df = df.sort_values('ë‚ ì§œ')

# ìˆ«ìí˜• ì •ë¦¬
df['ê±°ë˜ê¸ˆì•¡_ë§Œì›'] = pd.to_numeric(df['ê±°ë˜ê¸ˆì•¡_ë§Œì›'], errors='coerce').fillna(0)

# ì‚¬ì´ë“œë°”: ì§€ì—­ ì„ íƒ
ì§€ì—­_ëª©ë¡ = df['ì§€ì—­'].unique()
ì„ íƒ_ì§€ì—­ = st.sidebar.multiselect("ğŸ“ ë¶„ì„í•  ì§€ì—­ ì„ íƒ", options=ì§€ì—­_ëª©ë¡, default=ì§€ì—­_ëª©ë¡[:3])

# í•„í„°ë§
filtered = df[df['ì§€ì—­'].isin(ì„ íƒ_ì§€ì—­)]

# ì‹œê³„ì—´ ë¼ì¸ ê·¸ë˜í”„: ì§€ì—­ë³„ ê°€ê²© ë³€ë™
st.subheader("ğŸ“ˆ ì§€ì—­ë³„ ê±°ë˜ ê¸ˆì•¡ ë³€ë™ ì¶”ì´ (ë§Œì› ê¸°ì¤€)")
fig = px.line(filtered, x='ë‚ ì§œ', y='ê±°ë˜ê¸ˆì•¡_ë§Œì›', color='ì§€ì—­',
              labels={'ê±°ë˜ê¸ˆì•¡_ë§Œì›': 'ê±°ë˜ ê¸ˆì•¡ (ë§Œì›)', 'ë‚ ì§œ': 'ê³„ì•½ì¼'},
              title="ì§€ì—­ë³„ ë¶€ë™ì‚° ê±°ë˜ ê¸ˆì•¡ ì‹œê³„ì—´ ì¶”ì´")
st.plotly_chart(fig, use_container_width=True)

# ì¶œì²˜
st.caption("ë°ì´í„° ì¶œì²˜: ì‚¬ìš©ì ì—…ë¡œë“œ íŒŒì¼")
