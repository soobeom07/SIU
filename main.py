import streamlit as st
import pandas as pd
import plotly.express as px

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df1 = pd.read_csv("ë™ë‹¨ìœ„_ë°ì´í„°.csv")  # ë™ ë‹¨ìœ„ ë°ì´í„° íŒŒì¼ëª…ì— ë§ê²Œ ìˆ˜ì •
df2 = pd.read_csv("êµ¬ë‹¨ìœ„_ë°ì´í„°.csv", encoding="cp949")  # êµ¬ ë‹¨ìœ„ ë°ì´í„°

# ì»¬ëŸ¼ëª… ì •ë¦¬
df1 = df1.rename(columns={
    'í–‰ì •êµ¬ì—­': 'ì§€ì—­',
    'ë¬¼ê±´ìˆ˜': 'ê±°ë˜ê±´ìˆ˜',
    'í† ì§€ë©´ì ': 'í† ì§€ë©´ì _ã¡',
    'ê±´ì¶•ë¬¼ë©´ì ': 'ê±´ì¶•ë¬¼ë©´ì _ã¡',
    'ê¸ˆì•¡': 'ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›'
})

df2 = df2.rename(columns={
    'í–‰ì •êµ¬ì—­': 'ì§€ì—­',
    'ê±°ë˜ì‹ ê³ (ë¬¼ê±´ìˆ˜)': 'ê±°ë˜ê±´ìˆ˜',
    'ê±°ë˜ì‹ ê³  í† ì§€ë©´ì (ì œê³±ë¯¸í„°)': 'í† ì§€ë©´ì _ã¡',
    'ê±°ë˜ì‹ ê³ ê±´ì¶•ë¬¼ë©´ì (ì œê³±ë¯¸í„°)': 'ê±´ì¶•ë¬¼ë©´ì _ã¡',
    'ê±°ë˜ì‹ ê³  ê¸ˆì•¡(ë°±ë§Œì›)': 'ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›'
})

# Streamlit UI ì„¤ì •
st.set_page_config(page_title="ë¶€ë™ì‚° ê°€ê²© ë¶„ì„ ëŒ€ì‹œë³´ë“œ", layout="wide")
st.title("ğŸ™ï¸ ì§€ì—­ë³„ ë¶€ë™ì‚° ê±°ë˜ ë¶„ì„")

# ë°ì´í„° ì„ íƒ
data_option = st.sidebar.radio("ë¶„ì„í•  ë°ì´í„° ì„ íƒ", ("ë™ ë‹¨ìœ„", "êµ¬ ë‹¨ìœ„"))
if data_option == "ë™ ë‹¨ìœ„":
    df = df1.copy()
else:
    df = df2.copy()

ì§€ì—­_ì„ íƒ = st.sidebar.selectbox("ì§€ì—­ ì„ íƒ", df['ì§€ì—­'].unique())
filtered = df[df['ì§€ì—­'] == ì§€ì—­_ì„ íƒ]

# ìš”ì•½ ì •ë³´ ì¶œë ¥
st.subheader(f"ğŸ“Œ {ì§€ì—­_ì„ íƒ} ê±°ë˜ ìš”ì•½")
st.write(filtered)

col1, col2, col3 = st.columns(3)
col1.metric("ê±°ë˜ ê±´ìˆ˜", int(filtered['ê±°ë˜ê±´ìˆ˜'].values[0]))
col2.metric("í† ì§€ ë©´ì  (ã¡)", f"{filtered['í† ì§€ë©´ì _ã¡'].values[0]:,.2f}")
col3.metric("ê±´ì¶•ë¬¼ ë©´ì  (ã¡)", f"{filtered['ê±´ì¶•ë¬¼ë©´ì _ã¡'].values[0]:,.2f}")

# ì‹œê°í™”
st.subheader("ğŸ“Š ì§€ì—­ë³„ ê±°ë˜ ê¸ˆì•¡ ë¹„êµ")
fig = px.bar(df.sort_values('ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›', ascending=False), x='ì§€ì—­', y='ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›',
             labels={'ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›': 'ê±°ë˜ ê¸ˆì•¡ (ë°±ë§Œì›)'}, color='ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›')
st.plotly_chart(fig, use_container_width=True)

# ì‚°ì ë„: ë©´ì  ëŒ€ë¹„ ê¸ˆì•¡
st.subheader("ğŸ’¡ ë©´ì  ëŒ€ë¹„ ê±°ë˜ ê¸ˆì•¡")
fig2 = px.scatter(df, x='í† ì§€ë©´ì _ã¡', y='ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›', size='ê±´ì¶•ë¬¼ë©´ì _ã¡',
                  hover_name='ì§€ì—­', trendline='ols',
                  labels={'í† ì§€ë©´ì _ã¡': 'í† ì§€ ë©´ì  (ã¡)', 'ê±°ë˜ê¸ˆì•¡_ë°±ë§Œì›': 'ê±°ë˜ ê¸ˆì•¡ (ë°±ë§Œì›)'})
st.plotly_chart(fig2, use_container_width=True)

# í‘¸í„°
st.caption("ë°ì´í„° ì¶œì²˜: ê³µê³µë°ì´í„°í¬í„¸ / ì„œìš¸ì—´ë¦°ë°ì´í„°ê´‘ì¥ ë“± ê³µê°œ ë°ì´í„°")
